<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¸é™¸æ•™è‚²é›†åœ˜ - è³‡å„ªé‘‘å®šé¢è©¦è©•æ¸¬ç³»çµ± (PSI 50åˆ†ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #c0392b;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .top-logo {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .input-group {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .input-wrapper { flex: 1; margin-right: 20px; }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #status-msg {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: bold;
            display: none;
        }

        .module-card {
            background: var(--card-bg);
            border-left: 5px solid #ccc;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .module-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .module-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }

        .slider-container {
            margin-top: 20px;
            padding: 0 10px;
        }

        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #555;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .score-display-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .current-score {
            font-size: 2rem;
            font-weight: bold;
            width: 80px;
            text-align: center;
        }

        .score-meaning {
            flex: 1;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
        }
        
        .level-low { background-color: #fadbd8; color: #c0392b; }
        .level-mid { background-color: #fdebd0; color: #d35400; }
        .level-high { background-color: #d4efdf; color: #27ae60; }

        .action-area {
            text-align: center;
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        button.generate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            transition: transform 0.2s;
        }

        button.clear-btn {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
        }

        #report-section {
            display: none;
            margin-top: 40px;
            background: #fff;
            padding: 50px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .report-header {
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: end;
        }

        .report-block { margin-bottom: 30px; }

        .report-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1rem;
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
            margin-bottom: 8px;
        }

        .report-content {
            font-size: 1.05rem;
            text-align: justify;
            margin-left: 14px;
        }

        .stat-bar { display: flex; align-items: center; margin-bottom: 8px; }
        .stat-label { width: 110px; font-weight: bold; font-size: 0.9rem; }
        .stat-track { flex: 1; height: 12px; background: #e0e0e0; border: 1px solid #999; border-radius: 5px; overflow: hidden; margin: 0 10px; }
        .stat-fill { height: 100%; }
        .stat-val { width: 70px; font-size: 0.95rem; font-weight: bold; text-align: right; }

        @media print {
            body { background: white; padding: 40px; -webkit-print-color-adjust: exact !important; }
            header, .input-group, .module-card, .action-area, button { display: none !important; }
            #report-section { display: block !important; border: none; box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <img src="DL NEW LOGO BN.png" alt="å…¸é™¸æ•™è‚²é›†åœ˜" class="top-logo">

    <header>
        <div class="subtitle">Gifted Identification Assessment System (Full 5 Index)</div>
    </header>

    <div class="input-group">
        <div class="input-wrapper">
            <label for="studentName">è€ƒç”Ÿå§“åï¼š</label>
            <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" oninput="saveToLocal()">
        </div>
        <div id="status-msg">âœ… å·²æš«å­˜</div>
    </div>

    <div class="module-card" style="border-left-color: #e67e22;">
        <div class="module-title">1. èªæ–‡ç†è§£ (VCI) <span style="font-size:0.8rem; color:#e67e22;">æ»¿åˆ† 40</span></div>
        <div class="module-desc">0-14: åæ‡‰æœŸ | 15-31: åŠŸèƒ½æœŸ | 32-40: æŠ½è±¡æœŸ</div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="vci-slider" oninput="updateScore('vci', this.value); saveToLocal();">
            <div class="score-display-area">
                <span class="current-score" id="vci-val" style="color:#e67e22;">20</span>
                <span class="score-meaning level-mid" id="vci-meaning">åŠŸèƒ½æœŸ</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #8e44ad;">
        <div class="module-title">2. è¦–è¦ºç©ºé–“ (VSI) <span style="font-size:0.8rem; color:#8e44ad;">æ»¿åˆ† 40</span></div>
        <div class="module-desc">0-14: å…·é«”æœŸ | 15-31: æ“ä½œæœŸ | 32-40: å®Œå½¢æœŸ</div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="vsi-slider" oninput="updateScore('vsi', this.value); saveToLocal();">
            <div class="score-display-area">
                <span class="current-score" id="vsi-val" style="color:#8e44ad;">20</span>
                <span class="score-meaning level-mid" id="vsi-meaning">æ“ä½œæœŸ</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #2980b9;">
        <div class="module-title">3. æµé«”æ¨ç† (FRI) <span style="font-size:0.8rem; color:#2980b9;">æ»¿åˆ† 80</span></div>
        <div class="module-desc">0-28: å–®ç¶­æœŸ | 29-63: åºåˆ—æœŸ | 64-80: å¹³è¡ŒæœŸ</div>
        <div class="slider-container">
            <input type="range" min="0" max="80" value="40" class="range-slider" id="fri-slider" oninput="updateScore('fri', this.value); saveToLocal();">
            <div class="score-display-area">
                <span class="current-score" id="fri-val" style="color:#2980b9;">40</span>
                <span class="score-meaning level-mid" id="fri-meaning">åºåˆ—æœŸ</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #27ae60;">
        <div class="module-title">4. å·¥ä½œè¨˜æ†¶ (WMI) <span style="font-size:0.8rem; color:#27ae60;">æ»¿åˆ† 40</span></div>
        <div class="module-desc">0-14: æº¢å‡ºæœŸ | 15-31: åˆ†æ®µæœŸ | 32-40: å…§åŒ–æœŸ</div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="wmi-slider" oninput="updateScore('wmi', this.value); saveToLocal();">
            <div class="score-display-area">
                <span class="current-score" id="wmi-val" style="color:#27ae60;">20</span>
                <span class="score-meaning level-mid" id="wmi-meaning">åˆ†æ®µæœŸ</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #e74c3c;">
        <div class="module-title">5. è™•ç†é€Ÿåº¦ (PSI) <span style="font-size:0.8rem; color:#e74c3c;">æ»¿åˆ† 50</span></div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-50)ï¼š</strong><br>
            0-17: éŒ¯æ¼å­—å¤š/å‹•ä½œé²ç·© (ç„¦æ…®æœŸ)<br>
            18-39: é€Ÿåº¦å°šå¯/æ­£ç¢ºç‡ä½³ (æ¨™æº–æœŸ)<br>
            40-50: é«˜é€Ÿè‡ªå‹•åŒ–æƒæ (è‡ªå‹•åŒ–)
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="50" value="25" class="range-slider" id="psi-slider" oninput="updateScore('psi', this.value); saveToLocal();">
            <div class="score-display-area">
                <span class="current-score" id="psi-val" style="color:#e74c3c;">25</span>
                <span class="score-meaning level-mid" id="psi-meaning">æ¨™æº–æœŸ</span>
            </div>
        </div>
    </div>

    <div class="action-area">
        <button class="clear-btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤/ä¸‹ä¸€ä½</button>
        <button class="generate-btn" onclick="generateReport()">ç”Ÿæˆè©•ä¼°å ±å‘Š</button>
    </div>

    <div id="report-section">
        <div class="report-header">
            <div><h2 style="margin:0;">ä¸€èˆ¬æ™ºèƒ½è³‡å„ªé‘‘å®šé¢è©¦è©•èªè¡¨</h2></div>
            <div style="text-align:right;">
                <div style="font-size:1.5rem; font-weight:bold;" id="report-name"></div>
                <div style="font-size:0.9rem;" id="report-date"></div>
            </div>
        </div>

        <div style="margin-bottom:30px; background:#f9f9f9; padding:15px; border-radius:8px;">
            <div class="stat-bar"><span class="stat-label">VCI èªæ–‡ç†è§£</span><div class="stat-track"><div class="stat-fill" id="bar-vci" style="background:#e67e22;"></div></div><span class="stat-val" id="text-vci"></span></div>
            <div class="stat-bar"><span class="stat-label">VSI è¦–è¦ºç©ºé–“</span><div class="stat-track"><div class="stat-fill" id="bar-vsi" style="background:#8e44ad;"></div></div><span class="stat-val" id="text-vsi"></span></div>
            <div class="stat-bar"><span class="stat-label">FRI æµé«”æ¨ç†</span><div class="stat-track"><div class="stat-fill" id="bar-fri" style="background:#2980b9;"></div></div><span class="stat-val" id="text-fri"></span></div>
            <div class="stat-bar"><span class="stat-label">WMI å·¥ä½œè¨˜æ†¶</span><div class="stat-track"><div class="stat-fill" id="bar-wmi" style="background:#27ae60;"></div></div><span class="stat-val" id="text-wmi"></span></div>
            <div class="stat-bar"><span class="stat-label">PSI è™•ç†é€Ÿåº¦</span><div class="stat-track"><div class="stat-fill" id="bar-psi" style="background:#e74c3c;"></div></div><span class="stat-val" id="text-psi"></span></div>
            <div style="text-align:right; font-weight:bold; margin-top:10px;">ç¸½åˆ†ç™¾åˆ†æ¯”ï¼š<span id="total-score"></span></div>
        </div>

        <div class="report-block">
            <div class="report-label">1. å„ªå‹¢åˆ†æ (Strength Analysis)</div>
            <div class="report-content" id="report-strength"></div>
        </div>
        <div class="report-block">
            <div class="report-label">2. å¼±é»è¨ºæ–·èˆ‡ 2E é¢¨éšª (Weakness & 2E Check)</div>
            <div class="report-content" id="report-weakness"></div>
        </div>
        <div class="report-block">
            <div class="report-label">3. éŒ„å–èˆ‡åˆ†ç­å»ºè­° (Placement Suggestion)</div>
            <div class="report-content" id="report-suggestion" style="font-weight:bold; color:var(--primary-color);"></div>
        </div>
    </div>

    <div style="margin-top:30px; text-align:center;">
        <button class="generate-btn" onclick="window.print()" style="background-color:#27ae60;">ğŸ“¥ ä¸‹è¼‰ / åˆ—å° PDF</button>
    </div>
</div>

<script>
    const MAX_SCORES = { vci: 40, vsi: 40, fri: 80, wmi: 40, psi: 50 }; // PSI æ”¹ç‚º 50
    const PERCENT_HIGH = 0.8;
    const PERCENT_LOW = 0.35;
    const STORAGE_KEY = 'gias_v5_psi50';

    window.onload = loadFromLocal;

    function saveToLocal() {
        const data = {
            name: document.getElementById('studentName').value,
            vci: document.getElementById('vci-slider').value,
            vsi: document.getElementById('vsi-slider').value,
            fri: document.getElementById('fri-slider').value,
            wmi: document.getElementById('wmi-slider').value,
            psi: document.getElementById('psi-slider').value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        const status = document.getElementById('status-msg');
        status.style.display = 'block';
        setTimeout(() => { status.style.display = 'none'; }, 1000);
    }

    function loadFromLocal() {
        const saved = localStorage.getItem(STORAGE_KEY);
        const def = { name:'', vci: 20, vsi: 20, fri: 40, wmi: 20, psi: 25 };
        const data = saved ? JSON.parse(saved) : def;
        
        document.getElementById('studentName').value = data.name;
        Object.keys(MAX_SCORES).forEach(k => {
            document.getElementById(k + '-slider').value = data[k];
            updateScore(k, data[k]);
        });
        document.getElementById('report-date').innerText = new Date().toLocaleDateString('zh-TW', {year:'numeric', month:'long', day:'numeric'});
    }

    function updateScore(mod, val) {
        val = parseInt(val);
        const max = MAX_SCORES[mod];
        const pct = (val / max) * 100;
        document.getElementById(mod + '-val').innerText = val;
        
        const colors = { vci:'#e67e22', vsi:'#8e44ad', fri:'#2980b9', wmi:'#27ae60', psi:'#e74c3c' };
        document.getElementById(mod + '-slider').style.background = `linear-gradient(to right, ${colors[mod]} 0%, ${colors[mod]} ${pct}%, #d3d3d3 ${pct}%)`;

        const labels = {
            vci: ['åæ‡‰æœŸ', 'åŠŸèƒ½æœŸ', 'æŠ½è±¡æœŸ'],
            vsi: ['å…·é«”æœŸ', 'æ“ä½œæœŸ', 'å®Œå½¢æœŸ'],
            fri: ['å–®ç¶­æœŸ', 'åºåˆ—æœŸ', 'å¹³è¡ŒæœŸ'],
            wmi: ['æº¢å‡ºæœŸ', 'åˆ†æ®µæœŸ', 'å…§åŒ–æœŸ'],
            psi: ['ç„¦æ…®æœŸ', 'æ¨™æº–æœŸ', 'è‡ªå‹•åŒ–']
        };

        const target = document.getElementById(mod + '-meaning');
        target.className = 'score-meaning ' + (pct >= 80 ? 'level-high' : (pct > 35 ? 'level-mid' : 'level-low'));
        target.innerText = labels[mod][pct >= 80 ? 2 : (pct > 35 ? 1 : 0)];
    }

    function generateReport() {
        const name = document.getElementById('studentName').value;
        if (!name) { alert("è«‹è¼¸å…¥å§“å"); return; }

        let total = 0;
        let totalMax = 0;
        const pcts = {};

        Object.keys(MAX_SCORES).forEach(k => {
            const val = parseInt(document.getElementById(k + '-slider').value);
            const max = MAX_SCORES[k];
            const p = Math.round((val / max) * 100);
            pcts[k] = val / max;
            total += val;
            totalMax += max;
            document.getElementById('bar-' + k).style.width = p + '%';
            document.getElementById('text-' + k).innerText = p + '%';
        });

        document.getElementById('total-score').innerText = Math.round((total / totalMax) * 100) + '%';
        document.getElementById('report-name').innerText = name;

        // Logic
        let strengths = [];
        if(pcts.vci >= 0.8) strengths.push("ã€èªæ–‡ç†è§£ã€‘æŠ½è±¡æ¦‚æ‹¬åŠ›å„ªç•°ã€‚");
        if(pcts.vsi >= 0.8) strengths.push("ã€è¦–è¦ºç©ºé–“ã€‘å®Œå½¢å»ºæ§‹èƒ½åŠ›æ¥µä½³ã€‚");
        if(pcts.fri >= 0.8) strengths.push("ã€æµé«”æ¨ç†ã€‘é‚è¼¯æ¼”ç®—æ³•æ€ç¶­å¼·ã€‚");
        if(pcts.wmi >= 0.8) strengths.push("ã€å·¥ä½œè¨˜æ†¶ã€‘è³‡è¨Šé‡çµ„æ•ˆç‡é«˜ã€‚");
        if(pcts.psi >= 0.8) strengths.push("ã€è™•ç†é€Ÿåº¦ã€‘èªçŸ¥ç”¢å‡ºé«˜åº¦è‡ªå‹•åŒ–ã€‚");

        document.getElementById('report-strength').innerHTML = strengths.length ? strengths.join('<br>') : "å°šæœªé”é¡¯è‘—å„ªå‹¢ã€‚";

        // 2E & Weakness
        let weakness = "ç„¡é¡¯è‘—å¼±é»ã€‚";
        const gai = (pcts.vci + pcts.vsi + pcts.fri) / 3;
        const cpi = (pcts.wmi + pcts.psi) / 2;
        if (gai >= 0.8 && cpi <= 0.5) weakness = "ã€2E é¢¨éšªã€‘ï¼šé«˜æ½›èƒ½ä½æ•ˆèƒ½ï¼Œæ€è€ƒå¿«ä½†ç”¢å‡ºæ…¢ã€‚";
        else if (pcts.psi < 0.35) weakness = "ã€é€Ÿåº¦åå¼±ã€‘ï¼šè¦–è¦ºæƒææˆ–åŸ·è¡Œé€Ÿåº¦é¡¯è‘—ç·©æ…¢ã€‚";
        document.getElementById('report-weakness').innerText = weakness;

        // Suggestion
        const avg = total / totalMax;
        let sugg = avg >= 0.85 ? "ã€ä¸€èˆ¬æ™ºèƒ½è³‡å„ªã€‘ï¼šå»ºè­°å®‰ç½®æ–¼é«˜æŒ‘æˆ°æ€§è³‡å„ªæ–¹æ¡ˆã€‚" : 
                   (pcts.vci >= 0.8 || pcts.fri >= 0.8 ? "ã€å­¸è¡“æ€§å‘å„ªç•°ã€‘ï¼šå»ºè­°é‡å°å„ªå‹¢å­¸ç§‘åŠ æ·±åŠ å»£ã€‚" : "ã€æœªé”é‘‘å®šæ¨™æº–ã€‘ï¼šå»ºè­°å›æ­¸æ™®é€šç­æ•™å­¸ã€‚");
        document.getElementById('report-suggestion').innerText = sugg;

        document.getElementById('report-section').style.display = 'block';
        document.getElementById('report-section').scrollIntoView({behavior:'smooth'});
    }

    function clearData() {
        if(confirm("æ¸…é™¤è³‡æ–™ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }
</script>
</body>
</html>