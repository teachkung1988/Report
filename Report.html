<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¸é™¸æ•™è‚²é›†åœ˜ - è³‡å„ªé‘‘å®šé¢è©¦è©•æ¸¬ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #c0392b;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Logo æ¨£å¼ */
        .top-logo {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .input-group {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .input-wrapper { flex: 1; margin-right: 20px; }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        /* ç‹€æ…‹æ¨™ç±¤ */
        #status-msg {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: bold;
            display: none;
        }

        /* Module Cards */
        .module-card {
            background: var(--card-bg);
            border-left: 5px solid #ccc;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .module-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .module-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }

        /* Slider Styles */
        .slider-container {
            margin-top: 20px;
            padding: 0 10px;
        }

        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .range-slider:hover { opacity: 1; }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #555;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .score-display-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .current-score {
            font-size: 2rem;
            font-weight: bold;
            width: 80px;
            text-align: center;
        }

        .score-meaning {
            flex: 1;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
        }
        
        .level-low { background-color: #fadbd8; color: #c0392b; }
        .level-mid { background-color: #fdebd0; color: #d35400; }
        .level-high { background-color: #d4efdf; color: #27ae60; }

        /* Action Buttons */
        .action-area {
            text-align: center;
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        button.generate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            transition: transform 0.2s;
        }

        button.generate-btn:hover {
            background-color: #1a252f;
            transform: translateY(-2px);
        }

        button.clear-btn {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
            transition: transform 0.2s;
        }

        button.clear-btn:hover {
            background-color: #7f8c8d;
            transform: translateY(-2px);
        }

        /* Report Section */
        #report-section {
            display: none;
            margin-top: 40px;
            background: #fff;
            padding: 50px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .report-header {
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: end;
        }

        .report-block { margin-bottom: 30px; }

        .report-label {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1rem;
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
            margin-bottom: 8px;
        }

        .report-content {
            font-size: 1.05rem;
            text-align: justify;
            margin-left: 14px;
        }

        /* Radar Bar & Stats */
        .stat-bar { display: flex; align-items: center; margin-bottom: 8px; }
        .stat-label { width: 110px; font-weight: bold; font-size: 0.9rem; white-space: nowrap; }
        .stat-track { flex: 1; height: 12px; background: #e0e0e0; border: 1px solid #999; border-radius: 5px; overflow: hidden; margin: 0 10px; }
        .stat-fill { height: 100%; }
        .stat-val { width: 70px; font-size: 0.95rem; color: #333; font-weight: bold; text-align: right; }

        /* Print Styles */
        @media print {
            @page { margin: 0; size: auto; }
            body { 
                background: white; 
                padding: 40px; 
                margin: 0; 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
            }
            .container { max-width: 100%; width: 100%; }
            header, .input-group, .module-card, .action-area, button { display: none !important; }
            #report-section { display: block !important; margin: 0; padding: 0; box-shadow: none; border: none; }
            .top-logo { display: block !important; margin-bottom: 20px; }
            .stat-bar { page-break-inside: avoid; display: flex; align-items: center; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .stat-track { background-color: #e0e0e0 !important; border: 1px solid #999 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .stat-fill { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            #bar-vci { background: #e67e22 !important; }
            #bar-vsi { background: #8e44ad !important; }
            #bar-fri { background: #2980b9 !important; }
            #bar-wmi { background: #27ae60 !important; }
            #bar-psi { background: #e74c3c !important; }
            .report-block { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="container">
    <img src="DL NEW LOGO BN.png" alt="å…¸é™¸æ•™è‚²é›†åœ˜" class="top-logo">

    <header>
        <div class="subtitle">Gifted Identification Assessment System (Full 5 Index)</div>
    </header>

    <div class="input-group">
        <div class="input-wrapper">
            <label for="studentName">è€ƒç”Ÿå§“åï¼š</label>
            <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" oninput="saveToLocal()">
        </div>
        <div id="status-msg">âœ… å·²æš«å­˜</div>
    </div>

    <div class="module-card" style="border-left-color: #e67e22;">
        <div class="module-title">
            1. èªæ–‡ç†è§£ (VCI)
            <span style="font-size:0.8rem; color:#e67e22;">æ»¿åˆ† 40</span>
        </div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-40)ï¼š</strong><br>
            0-14: è¡¨é¢ç‰¹å¾µ/éŒ¯èª¤ (åæ‡‰æœŸ)<br>
            15-31: åŠŸèƒ½æ€§æè¿°/æ­£ç¢ºä½†å…·é«” (åŠŸèƒ½æœŸ)<br>
            32-40: æœ¬è³ªå®šç¾©/å¾Œè¨­èªçŸ¥ (æŠ½è±¡æœŸ)
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="vci-slider" oninput="updateScore('vci', this.value); saveToLocal();" style="background: linear-gradient(to right, #e67e22 0%, #e67e22 50%, #d3d3d3 50%);">
            <div class="score-display-area">
                <span class="current-score" id="vci-val" style="color:#e67e22;">20</span>
                <span class="score-meaning level-mid" id="vci-meaning">åŠŸèƒ½æœŸ (Functional)</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #8e44ad;">
        <div class="module-title">
            2. è¦–è¦ºç©ºé–“ (VSI)
            <span style="font-size:0.8rem; color:#8e44ad;">æ»¿åˆ† 40</span>
        </div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-40)ï¼š</strong><br>
            0-14: ä¾è³´ç¶²æ ¼ç·šç´¢/ç„¡æ³•è½‰æ›è¦–è§’<br>
            15-31: éœ€å˜—è©¦éŒ¯èª¤/å…·é«”æ“ä½œæ–¹èƒ½è§£é¡Œ<br>
            32-40: ç„¡ç·šç´¢å®Œå½¢/å¤šè§’åº¦å¿ƒç†æ—‹è½‰
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="vsi-slider" oninput="updateScore('vsi', this.value); saveToLocal();" style="background: linear-gradient(to right, #8e44ad 0%, #8e44ad 50%, #d3d3d3 50%);">
            <div class="score-display-area">
                <span class="current-score" id="vsi-val" style="color:#8e44ad;">20</span>
                <span class="score-meaning level-mid" id="vsi-meaning">æ“ä½œæœŸ (Operational)</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #2980b9;">
        <div class="module-title">
            3. æµé«”æ¨ç† (FRI)
            <span style="font-size:0.8rem; color:#2980b9;">æ»¿åˆ† 80</span>
        </div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-80)ï¼š</strong><br>
            0-28: åƒ…å–®ä¸€ç¶­åº¦/éºæ¼è¦å‰‡ (å–®ç¶­æœŸ)<br>
            29-63: éœ€é€æ­¥æ¨å°/åºåˆ—è™•ç† (åºåˆ—æœŸ)<br>
            64-80: å¤šå·¥å¹³è¡Œè™•ç†/ç¬é–“è§£é¡Œ (å¹³è¡ŒæœŸ)
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="80" value="40" class="range-slider" id="fri-slider" oninput="updateScore('fri', this.value); saveToLocal();" style="background: linear-gradient(to right, #2980b9 0%, #2980b9 50%, #d3d3d3 50%);">
            <div class="score-display-area">
                <span class="current-score" id="fri-val" style="color:#2980b9;">40</span>
                <span class="score-meaning level-mid" id="fri-meaning">åºåˆ—æœŸ (Serial)</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #27ae60;">
        <div class="module-title">
            4. å·¥ä½œè¨˜æ†¶ (WMI)
            <span style="font-size:0.8rem; color:#27ae60;">æ»¿åˆ† 40</span>
        </div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-40)ï¼š</strong><br>
            0-14: å®¹é‡æº¢å‡º/ç„¡æ³•è¤‡è¿°<br>
            15-31: åˆ†æ®µåŸ·è¡Œ/éœ€è¼”åŠ©ç­–ç•¥<br>
            32-40: å…§åœ¨æ“ä½œ/ç²¾ç¢ºé‡çµ„
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="wmi-slider" oninput="updateScore('wmi', this.value); saveToLocal();" style="background: linear-gradient(to right, #27ae60 0%, #27ae60 50%, #d3d3d3 50%);">
            <div class="score-display-area">
                <span class="current-score" id="wmi-val" style="color:#27ae60;">20</span>
                <span class="score-meaning level-mid" id="wmi-meaning">åˆ†æ®µæœŸ (Segmented)</span>
            </div>
        </div>
    </div>

    <div class="module-card" style="border-left-color: #e74c3c;">
        <div class="module-title">
            5. è™•ç†é€Ÿåº¦ (PSI)
            <span style="font-size:0.8rem; color:#e74c3c;">æ»¿åˆ† 40</span>
        </div>
        <div class="module-desc">
            <strong>è©•åˆ†æ¨™æº– (0-40)ï¼š</strong><br>
            0-14: éŒ¯æ¼å­—å¤š/å‹•ä½œé²ç·© (ç„¦æ…®æœŸ)<br>
            15-31: é€Ÿåº¦å°šå¯/æ­£ç¢ºç‡ä½³ (æ¨™æº–æœŸ)<br>
            32-40: é«˜é€Ÿè‡ªå‹•åŒ–æƒæ (è‡ªå‹•åŒ–)
        </div>
        <div class="slider-container">
            <input type="range" min="0" max="40" value="20" class="range-slider" id="psi-slider" oninput="updateScore('psi', this.value); saveToLocal();" style="background: linear-gradient(to right, #e74c3c 0%, #e74c3c 50%, #d3d3d3 50%);">
            <div class="score-display-area">
                <span class="current-score" id="psi-val" style="color:#e74c3c;">20</span>
                <span class="score-meaning level-mid" id="psi-meaning">æ¨™æº–æœŸ (Standard)</span>
            </div>
        </div>
    </div>

    <div class="action-area">
        <button class="clear-btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤/ä¸‹ä¸€ä½</button>
        <button class="generate-btn" onclick="generateReport()">ç”Ÿæˆè©•ä¼°å ±å‘Š</button>
    </div>

    <div id="report-section">
        <div class="report-header">
            <div>
                <h2 style="margin:0;">ä¸€èˆ¬æ™ºèƒ½è³‡å„ªé‘‘å®šé¢è©¦è©•èªè¡¨</h2>
            </div>
            <div style="text-align:right;">
                <div style="font-size:1.5rem; font-weight:bold;" id="report-name"></div>
                <div style="font-size:0.9rem;" id="report-date"></div>
            </div>
        </div>

        <div style="margin-bottom:30px; background:#f9f9f9; padding:15px; border-radius:8px;">
            <div class="stat-bar"><span class="stat-label">VCI èªæ–‡ç†è§£</span><div class="stat-track"><div class="stat-fill" id="bar-vci" style="width: 50%; background:#e67e22;"></div></div><span class="stat-val" id="text-vci">50%</span></div>
            <div class="stat-bar"><span class="stat-label">VSI è¦–è¦ºç©ºé–“</span><div class="stat-track"><div class="stat-fill" id="bar-vsi" style="width: 50%; background:#8e44ad;"></div></div><span class="stat-val" id="text-vsi">50%</span></div>
            <div class="stat-bar"><span class="stat-label">FRI æµé«”æ¨ç†</span><div class="stat-track"><div class="stat-fill" id="bar-fri" style="width: 50%; background:#2980b9;"></div></div><span class="stat-val" id="text-fri">50%</span></div>
            <div class="stat-bar"><span class="stat-label">WMI å·¥ä½œè¨˜æ†¶</span><div class="stat-track"><div class="stat-fill" id="bar-wmi" style="width: 50%; background:#27ae60;"></div></div><span class="stat-val" id="text-wmi">50%</span></div>
            <div class="stat-bar"><span class="stat-label">PSI è™•ç†é€Ÿåº¦</span><div class="stat-track"><div class="stat-fill" id="bar-psi" style="width: 50%; background:#e74c3c;"></div></div><span class="stat-val" id="text-psi">50%</span></div>
            
            <div style="text-align:right; font-weight:bold; margin-top:10px;">ç¸½åˆ†ï¼š<span id="total-score">50%</span></div>
        </div>

        <div class="report-block">
            <div class="report-label">1. å„ªå‹¢åˆ†æ (Strength Analysis)</div>
            <div class="report-content" id="report-strength"></div>
        </div>

        <div class="report-block">
            <div class="report-label">2. å¼±é»è¨ºæ–·èˆ‡ 2E é¢¨éšª (Weakness & 2E Check)</div>
            <div class="report-content" id="report-weakness"></div>
        </div>

        <div class="report-block">
            <div class="report-label">3. éŒ„å–èˆ‡åˆ†ç­å»ºè­° (Placement Suggestion)</div>
            <div class="report-content" id="report-suggestion" style="font-weight:bold; color:var(--primary-color);"></div>
        </div>
        
        <div style="margin-top:50px; border-top:1px dashed #ccc; padding-top:10px; font-size:0.8rem; color:#999; display:flex; justify-content:space-between;">
            <span>é¢è©¦å®˜ç°½åï¼š____________________</span>
            <span>è¤‡æ ¸ï¼š____________________</span>
        </div>
    </div>

    <div style="margin-top:30px; text-align:center;">
        <button class="generate-btn" onclick="downloadPDF()" style="background-color:#27ae60;">ğŸ“¥ ä¸‹è¼‰ç‚º PDF</button>
    </div>
</div>

<script>
    document.getElementById('report-date').innerText = new Date().toLocaleDateString('zh-TW', {year: 'numeric', month: 'long', day: 'numeric'});

    // æ ¸å¿ƒä¿®æ”¹ï¼šé™¤ FRI ç¶­æŒ 80 å¤–ï¼Œå…¶é¤˜çš†æ”¹ç‚º 40
    const MAX_SCORES = {
        vci: 40, 
        vsi: 40, 
        fri: 80, 
        wmi: 40, 
        psi: 40
    };

    const PERCENT_HIGH = 0.8; // 80%
    const PERCENT_LOW = 0.35; // 35%
    const STORAGE_KEY = 'gias_v4_data_final'; // æ›´æ–° key é¿å…èˆŠçš„ 80 åˆ†è³‡æ–™å¹²æ“¾

    // --- LocalStorage Functions ---
    window.onload = function() {
        loadFromLocal();
    };

    function saveToLocal() {
        const data = {
            name: document.getElementById('studentName').value,
            vci: document.getElementById('vci-slider').value,
            vsi: document.getElementById('vsi-slider').value,
            fri: document.getElementById('fri-slider').value,
            wmi: document.getElementById('wmi-slider').value,
            psi: document.getElementById('psi-slider').value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        
        // Show saved status
        const status = document.getElementById('status-msg');
        status.style.display = 'block';
        setTimeout(() => { status.style.display = 'none'; }, 1500);
    }

    function loadFromLocal() {
        const savedData = localStorage.getItem(STORAGE_KEY);
        // è¨­å®šé è¨­å€¼ (FRIç‚º40, å…¶ä»–ç‚º20)
        const def = { vci: 20, vsi: 20, fri: 40, wmi: 20, psi: 20 };

        if (savedData) {
            const data = JSON.parse(savedData);
            document.getElementById('studentName').value = data.name || '';
            document.getElementById('vci-slider').value = data.vci || def.vci;
            document.getElementById('vsi-slider').value = data.vsi || def.vsi;
            document.getElementById('fri-slider').value = data.fri || def.fri;
            document.getElementById('wmi-slider').value = data.wmi || def.wmi;
            document.getElementById('psi-slider').value = data.psi || def.psi;

            // Trigger updates for UI colors and text
            updateScore('vci', data.vci || def.vci);
            updateScore('vsi', data.vsi || def.vsi);
            updateScore('fri', data.fri || def.fri);
            updateScore('wmi', data.wmi || def.wmi);
            updateScore('psi', data.psi || def.psi);
        } else {
            // è‹¥ç„¡å­˜æª”ï¼Œåˆå§‹åŒ–é è¨­å€¼
            updateScore('vci', def.vci);
            updateScore('vsi', def.vsi);
            updateScore('fri', def.fri);
            updateScore('wmi', def.wmi);
            updateScore('psi', def.psi);
        }
    }

    function clearData() {
        if(confirm("ç¢ºå®šè¦æ¸…é™¤ç›®å‰è³‡æ–™ä¸¦è©•æ¸¬ä¸‹ä¸€ä½å­¸ç”Ÿå—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            document.getElementById('studentName').value = '';
            
            // é‡ç½®é è¨­å€¼ï¼šæ»¿åˆ†40çš„è¨­ç‚º20ï¼Œæ»¿åˆ†80çš„è¨­ç‚º40
            const defaults = { vci: 20, vsi: 20, fri: 40, wmi: 20, psi: 20 };
            
            document.getElementById('vci-slider').value = defaults.vci;
            document.getElementById('vsi-slider').value = defaults.vsi;
            document.getElementById('fri-slider').value = defaults.fri;
            document.getElementById('wmi-slider').value = defaults.wmi;
            document.getElementById('psi-slider').value = defaults.psi;

            updateScore('vci', defaults.vci);
            updateScore('vsi', defaults.vsi);
            updateScore('fri', defaults.fri);
            updateScore('wmi', defaults.wmi);
            updateScore('psi', defaults.psi);

            document.getElementById('report-section').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // --- Existing Logic ---

    function downloadPDF() {
        let name = document.getElementById('studentName').value;
        if (!name || name.trim() === '') {
            alert("è«‹å…ˆç”Ÿæˆå ±å‘Šå¾Œå†ä¸‹è¼‰ï¼");
            return;
        }

        document.querySelector('header').style.display = 'none';
        document.querySelector('.input-group').style.display = 'none';
        document.querySelectorAll('.module-card').forEach(el => el.style.display = 'none');
        document.querySelector('.action-area').style.display = 'none';
        document.querySelector('button[onclick="downloadPDF()"]').style.display = 'none';
        
        document.getElementById('report-section').style.display = 'block';
        window.print();
        
        setTimeout(() => {
            document.querySelector('header').style.display = 'block';
            document.querySelector('.input-group').style.display = 'block';
            document.querySelectorAll('.module-card').forEach(el => el.style.display = 'block');
            document.querySelector('.action-area').style.display = 'block';
            document.querySelector('button[onclick="downloadPDF()"]').style.display = 'block';
        }, 500);
    }   

    function updateScore(module, val) {
        val = parseInt(val);
        let max = MAX_SCORES[module];
        document.getElementById(module + '-val').innerText = val;
        
        let color = '#555';
        if(module === 'vci') color = '#e67e22';
        if(module === 'vsi') color = '#8e44ad';
        if(module === 'fri') color = '#2980b9';
        if(module === 'wmi') color = '#27ae60';
        if(module === 'psi') color = '#e74c3c';
        
        let percentage = (val / max) * 100;
        document.getElementById(module + '-slider').style.background = 
            `linear-gradient(to right, ${color} 0%, ${color} ${percentage}%, #d3d3d3 ${percentage}%)`;

        let meaningEl = document.getElementById(module + '-meaning');
        meaningEl.className = 'score-meaning';
        
        let texts = {
            'vci': ['åæ‡‰æœŸ', 'åŠŸèƒ½æœŸ', 'æŠ½è±¡æœŸ'],
            'vsi': ['å…·é«”æœŸ', 'æ“ä½œæœŸ', 'å®Œå½¢æœŸ'],
            'fri': ['å–®ç¶­æœŸ', 'åºåˆ—æœŸ', 'å¹³è¡ŒæœŸ'],
            'wmi': ['æº¢å‡ºæœŸ', 'åˆ†æ®µæœŸ', 'å…§åŒ–æœŸ'],
            'psi': ['é²ç·©/ç„¦æ…®', 'æ¨™æº–æœŸ', 'è‡ªå‹•åŒ–']
        };

        if (percentage >= (PERCENT_HIGH * 100)) {
            meaningEl.innerText = texts[module][2];
            meaningEl.classList.add('level-high');
        } else if (percentage > (PERCENT_LOW * 100)) {
            meaningEl.innerText = texts[module][1];
            meaningEl.classList.add('level-mid');
        } else {
            meaningEl.innerText = texts[module][0];
            meaningEl.classList.add('level-low');
        }
    }

    function generateReport() {
        let name = document.getElementById('studentName').value;
        if (!name) { alert("è«‹è¼¸å…¥è€ƒç”Ÿå§“åï¼"); return; }

        let vci = parseInt(document.getElementById('vci-slider').value);
        let vsi = parseInt(document.getElementById('vsi-slider').value);
        let fri = parseInt(document.getElementById('fri-slider').value);
        let wmi = parseInt(document.getElementById('wmi-slider').value);
        let psi = parseInt(document.getElementById('psi-slider').value);
        let total = vci + vsi + fri + wmi + psi;
        
        // ä¿®æ­£ç¸½åˆ†åŸºæ•¸ï¼š40+40+80+40+40 = 240
        let totalMax = 240; 

        // è¨ˆç®—å„é …ç™¾åˆ†æ¯”
        let p_vci = Math.round((vci / MAX_SCORES.vci) * 100);
        let p_vsi = Math.round((vsi / MAX_SCORES.vsi) * 100);
        let p_fri = Math.round((fri / MAX_SCORES.fri) * 100);
        let p_wmi = Math.round((wmi / MAX_SCORES.wmi) * 100);
        let p_psi = Math.round((psi / MAX_SCORES.psi) * 100);
        let p_total = Math.round((total / totalMax) * 100);

        // UI Update: æ›´æ–°é€²åº¦æ¢å¯¬åº¦èˆ‡é¡¯ç¤ºæ–‡å­—ç‚ºç™¾åˆ†æ¯”
        document.getElementById('bar-vci').style.width = p_vci + "%";
        document.getElementById('bar-vsi').style.width = p_vsi + "%";
        document.getElementById('bar-fri').style.width = p_fri + "%";
        document.getElementById('bar-wmi').style.width = p_wmi + "%";
        document.getElementById('bar-psi').style.width = p_psi + "%";
        
        // æ–‡å­—æ›´æ–°ç‚ºç™¾åˆ†æ¯”
        document.getElementById('text-vci').innerText = p_vci + "%";
        document.getElementById('text-vsi').innerText = p_vsi + "%";
        document.getElementById('text-fri').innerText = p_fri + "%";
        document.getElementById('text-wmi').innerText = p_wmi + "%";
        document.getElementById('text-psi').innerText = p_psi + "%";
        
        // ç¸½åˆ†åªé¡¯ç¤ºç™¾åˆ†æ¯”
        document.getElementById('total-score').innerText = `${p_total}%`;
        document.getElementById('report-name').innerText = name;

        // --- Logic Engine ---
        let strengthText = "";
        let weaknessText = "ç„¡é¡¯è‘—å¼±é»çµæ§‹ã€‚";
        let suggestionText = "";

        // Normalize scores to percentages (decimal 0.0 - 1.0) for logic comparison
        let dp_vci = vci / MAX_SCORES.vci;
        let dp_vsi = vsi / MAX_SCORES.vsi;
        let dp_fri = fri / MAX_SCORES.fri;
        let dp_wmi = wmi / MAX_SCORES.wmi;
        let dp_psi = psi / MAX_SCORES.psi;

        // 1. Strength Analysis
        let strengths = [];
        if (dp_vci >= PERCENT_HIGH) strengths.push("ã€èªæ–‡ç†è§£ã€‘ï¼šæ¦‚å¿µå®šç¾©ç²¾ç¢ºï¼Œå…·å‚™å„ªç•°çš„å¾Œè¨­èªçŸ¥èˆ‡æŠ½è±¡æ¦‚æ‹¬åŠ›ã€‚");
        if (dp_vsi >= PERCENT_HIGH) strengths.push("ã€è¦–è¦ºç©ºé–“ã€‘ï¼šå…·å‚™æ¥µä½³çš„å®Œå½¢å»ºæ§‹èƒ½åŠ›ï¼Œèƒ½é€²è¡Œå¤šè§’åº¦çš„å¿ƒç†æ—‹è½‰èˆ‡ç©ºé–“è¦åŠƒã€‚");
        if (dp_fri >= PERCENT_HIGH) strengths.push("ã€æµé«”æ¨ç†ã€‘ï¼šæ“…é•·è™•ç†å¤šé‡é‚è¼¯è®Šæ•¸ï¼Œå±•ç¾å‡ºæ¼”ç®—æ³•æ€ç¶­èˆ‡ç³»çµ±åˆ†ææ½›èƒ½ã€‚");
        if (dp_wmi >= PERCENT_HIGH) strengths.push("ã€å·¥ä½œè¨˜æ†¶ã€‘ï¼šè³‡è¨Šæš«å­˜èˆ‡é‡çµ„æ•ˆç‡æ¥µé«˜ï¼ŒæŠ—å¹²æ“¾èƒ½åŠ›å¼·ã€‚");
        if (dp_psi >= PERCENT_HIGH) strengths.push("ã€è™•ç†é€Ÿåº¦ã€‘ï¼šè¦–è¦ºæƒæèˆ‡æ‰‹çœ¼å”èª¿è‡ªå‹•åŒ–ç¨‹åº¦é«˜ï¼Œå…·å‚™é«˜æ•ˆç‡çš„èªçŸ¥ç”¢å‡ºã€‚");
        
        if (strengths.length > 0) {
            strengthText = strengths.join("<br>");
        } else {
            strengthText = "ç›®å‰å„åˆ†é …èƒ½åŠ›å°šæœªå±•ç¾é¡¯è‘—çš„ã€ŒæŠ½è±¡å±¤æ¬¡ã€å„ªå‹¢ (çš†æœªé”é«˜æ¨™)ã€‚";
        }

        // 2. Weakness & 2E Diagnosis
        let gai_percent = (dp_vci + dp_vsi + dp_fri) / 3;
        let cpi_percent = (dp_wmi + dp_psi) / 2;
        
        if (gai_percent >= PERCENT_HIGH && cpi_percent <= (PERCENT_LOW + 0.15)) {
             weaknessText = "ã€é«˜åº¦é—œæ³¨ - 2E é¢¨éšªã€‘ï¼šå­¸ç”Ÿå‘ˆç¾å…¸å‹çš„ã€Œé«˜æ½›èƒ½ã€ä½æ•ˆèƒ½ã€ç‰¹å¾µã€‚å…¶æ€è€ƒèˆ‡æ¨ç†èƒ½åŠ›æ¥µä½³ï¼Œä½†å—é™æ–¼è™•ç†é€Ÿåº¦æˆ–å·¥ä½œè¨˜æ†¶ã€‚é€™å¯èƒ½å°è‡´ã€Œæ€ç·’å¿«ä½†ç”¢å‡ºæ…¢ã€çš„æŒ«æŠ˜æ„Ÿï¼Œå»ºè­°é€²è¡Œé€²ä¸€æ­¥çš„å°ˆæ³¨åŠ›æˆ–è®€å¯«éšœç¤™ç¯©æª¢ã€‚";
        } 
        else if (dp_psi <= PERCENT_LOW) {
            weaknessText = "ã€é€Ÿåº¦åå¼±ã€‘ï¼šå­¸ç”Ÿæ€è€ƒå“è³ªä½³ï¼Œä½†è¦–è¦ºæƒæèˆ‡å‹•ä½œè¼¸å‡ºé¡¯è‘—ç·©æ…¢ï¼Œè€ƒè©¦æ™‚å¯èƒ½é¢è‡¨å¯«ä¸å®Œçš„å£“åŠ›ã€‚";
        }
        else {
            let scores_p = [dp_vci, dp_vsi, dp_fri, dp_wmi, dp_psi];
            let max_p = Math.max(...scores_p);
            let min_p = Math.min(...scores_p);
            if ((max_p - min_p) >= 0.4) { // 40% difference
                weaknessText = "ã€èƒ½åŠ›åˆ†å¸ƒä¸å‡ã€‘ï¼šè§€å¯Ÿåˆ°é¡¯è‘—çš„å¼·å¼±é …è½å·® (Scatter Profile)ï¼Œå»ºè­°é‡å°å¼±é …æä¾›å­¸ç¿’ç­–ç•¥æ”¯æŒï¼Œé¿å…å½±éŸ¿æ•´é«”è¡¨ç¾ã€‚";
            }
        }

        // 3. Placement Suggestion
        let total_percent = total / totalMax;

        if (total_percent >= 0.85) {
             suggestionText = "ã€ä¸€èˆ¬æ™ºèƒ½è³‡å„ª (æ¥µå„ªç•°)ã€‘ï¼šç¶œåˆæŒ‡æ¨™å‡è¡¡ä¸”é ‚å°–ï¼Œå»ºè­°å®‰ç½®æ–¼å¼·èª¿è·¨é ˜åŸŸæ•´åˆèˆ‡é«˜æŒ‘æˆ°æ€§çš„è³‡å„ªæ–¹æ¡ˆã€‚";
        } else if (dp_vci >= PERCENT_HIGH || dp_fri >= PERCENT_HIGH || dp_vsi >= PERCENT_HIGH) {
            let type = [];
            if(dp_vci >= PERCENT_HIGH) type.push("èªæ–‡");
            if(dp_fri >= PERCENT_HIGH) type.push("æ•¸ç†/é‚è¼¯");
            if(dp_vsi >= PERCENT_HIGH) type.push("ç©ºé–“/å·¥ç¨‹");
            suggestionText = `ã€å­¸è¡“æ€§å‘è³‡å„ªã€‘ï¼šé©åˆç™¼å±• ${type.join("/")} é ˜åŸŸï¼Œå»ºè­°åœ¨å„ªå‹¢å­¸ç§‘é€²è¡ŒåŠ æ·±åŠ å»£ã€‚`;
        } else {
             suggestionText = "ã€æœªé”é‘‘å®šæ¨™æº–ã€‘ï¼šå»ºè­°å›æ­¸æ™®é€šç­èª²ç¨‹ï¼Œä¸¦é‡å°å¼·é …é€²è¡Œå·®ç•°åŒ–æ•™å­¸ã€‚";
        }

        document.getElementById('report-strength').innerHTML = strengthText;
        document.getElementById('report-weakness').innerText = weaknessText;
        document.getElementById('report-suggestion').innerText = suggestionText;

        let reportSection = document.getElementById('report-section');
        reportSection.style.display = 'block';
        reportSection.scrollIntoView({behavior: "smooth"});
    }
</script>

</body>
</html>